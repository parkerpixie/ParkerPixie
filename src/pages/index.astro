---
// src/pages/blog/index.astro
// Magazine-style blog index with graceful fallbacks

// Grab posts next to this file, including subfolders:
const posts = await Astro.glob('./**/*.{md,mdx,astro}');

// Filter out this index file just in case, and anything without a URL
const entries = posts
  .filter(p => 'url' in p && p.url && !p.url.endsWith('/blog/'))
  .map(p => ({
    url: p.url,
    // Frontmatter with fallbacks
    title: p.frontmatter?.title ?? 'Untitled Post',
    date: p.frontmatter?.date ? new Date(p.frontmatter.date) : null,
    cover: p.frontmatter?.image ?? p.frontmatter?.cover ?? null,
    excerpt:
      p.frontmatter?.excerpt ??
      p.frontmatter?.description ??
      '',
    tags: Array.isArray(p.frontmatter?.tags) ? p.frontmatter.tags : [],
  }))
  // newest first
  .sort((a, b) => (b.date?.getTime?.() ?? 0) - (a.date?.getTime?.() ?? 0));
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>ParkerPixie · Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Cozy crafts, capybara lore, gaming, life & sparkle ✨"
    />
    <style>
      :root{
        --brand:#8a5dff;
        --brand-deep:#4b2bb8;
        --ink:#1b1326;
        --muted:#6e6280;
        --card:#ffffff;
        --bg: radial-gradient(1000px 600px at 10% -10%, #efe9ff 0%, #faf7ff 35%, #fff 60%),
              radial-gradient(800px 500px at 110% 20%, #ffe9f5 0%, #fff 60%);
        --ring: 0 0 0 2px rgba(138,93,255,.15), 0 10px 30px rgba(138,93,255,.15);
      }
      *{box-sizing:border-box}
      body{
        margin:0;
        color:var(--ink);
        font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
        background: var(--bg);
      }
      header{
        padding: clamp(24px, 4vw, 48px) 20px 8px;
        text-align:center;
      }
      .title{
        margin:0;
        font-weight:800;
        letter-spacing:.3px;
        font-size:clamp(28px, 4.2vw, 44px);
        color:var(--brand-deep);
      }
      .tagline{
        margin:.4rem 0 0;
        color:var(--muted);
        font-size:clamp(14px, 2.2vw, 18px);
      }

      .grid{
        display:grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: clamp(16px, 3vw, 28px);
        padding: clamp(16px, 4vw, 40px);
        max-width: 1200px;
        margin: 0 auto;
      }
      .card{
        background:var(--card);
        border-radius:20px;
        overflow:hidden;
        border:1px solid rgba(75,43,184,.08);
        box-shadow: 0 6px 18px rgba(27,19,38,.06);
        display:flex;
        flex-direction:column;
        transition: transform .18s ease, box-shadow .18s ease;
      }
      .card:hover{
        transform: translateY(-2px);
        box-shadow: var(--ring);
      }
      .cover{
        aspect-ratio: 16/9;
        width:100%;
        object-fit:cover;
        background:
          radial-gradient(200px 120px at 20% 10%, rgba(138,93,255,.18), transparent 60%),
          linear-gradient(180deg, #f6f1ff 0%, #fefcff 100%);
      }
      .content{ padding:18px; display:flex; flex-direction:column; gap:10px; }
      .post-title{
        margin:0;
        font-size:1.05rem;
        line-height:1.25;
      }
      .post-title a{
        color:inherit; text-decoration:none;
      }
      .post-title a:hover{ text-decoration:underline; text-decoration-thickness:2px; }
      .meta{
        font-size:.85rem; color:var(--muted); display:flex; gap:8px; flex-wrap:wrap;
      }
      .tags{ display:flex; gap:6px; flex-wrap:wrap; }
      .tag{
        font-size:.72rem;
        padding:3px 8px;
        border-radius:999px;
        background:rgba(138,93,255,.10);
        color:var(--brand-deep);
        border:1px solid rgba(138,93,255,.18);
      }
      .excerpt{ color:#3d344b; font-size:.95rem; }
      .empty{
        max-width:720px; margin:24px auto 64px; padding:0 20px; color:var(--muted); text-align:center;
      }
      footer{
        padding:32px 20px; text-align:center; color:var(--muted);
      }
    </style>
  </head>
  <body>
    <header>
      <h1 class="title">Blog</h1>
      <p class="tagline">Cozy crafts, capybara lore, gaming, life & sparkle ✨</p>
    </header>

    {entries.length === 0 ? (
      <div class="empty">
        <p>No posts yet. Add a Markdown file like <code>src/pages/blog/hello-world.md</code> with frontmatter.</p>
      </div>
    ) : (
      <main class="grid">
        {entries.map(post => (
          <article class="card">
            {post.cover
              ? <img class="cover" src={post.cover} alt="" loading="lazy" />
              : <div class="cover" aria-hidden="true"></div>}
            <div class="content">
              <h2 class="post-title"><a href={post.url}>{post.title}</a></h2>
              <div class="meta">
                {post.date && <time datetime={post.date.toISOString()}>
                  {post.date.toLocaleDateString(undefined, {year:'numeric', month:'short', day:'2-digit'})}
                </time>}
                {post.tags?.length > 0 && (
                  <span class="tags">
                    {post.tags.slice(0,4).map(t => <span class="tag">{t}</span>)}
                  </span>
                )}
              </div>
              {post.excerpt && <p class="excerpt">{post.excerpt}</p>}
            </div>
          </article>
        ))}
      </main>
    )}

    <footer>© ParkerPixie · Made with ✨ glitter ✨, sass, and love from Madison, WI</footer>
  </body>
</html>

